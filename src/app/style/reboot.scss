@use "sass:map";

// -------------------------------
// Configurações base
// -------------------------------
$font-family-sans: "Hanken Grotesk", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
$font-family-mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;

$brand-h: 199;//220;
$radius: 1rem;
$radiusxl: 65rem;
$border-w: 1px;
$outline-w: 2px;
$focus-ring-spread: 2px;
$container-max-width: 72rem;

$enable-smooth-scroll: true;
$enable-print-optimizations: true;

$space-scale: ( 0: 0, 1: 0.125rem, 2: 0.25rem, 3: 0.5rem, 4: 0.75rem, 5: 1rem, 6: 1.25rem, 7: 1.5rem, 8: 2rem, 9: 3rem, 10: 4rem );
$font-scale: (
  "4xs": clamp(0.214rem, 0.214rem + 0.021vw, 0.174rem),
  "3xs": clamp(0.321rem, 0.321rem + 0.032vw, 0.261rem),
  "2xs": clamp(0.428rem, 0.428rem + 0.043vw, 0.348rem),
  xs:   clamp(0.642rem, 0.642rem + 0.086vw, 0.695rem),
  sm:   clamp(0.749rem, 0.728rem + 0.128vw, 0.801rem),
  base: clamp(0.813rem, 0.770rem + 0.299vw, 0.908rem),
  lg:   clamp(0.897rem, 0.855rem + 0.427vw, 1.069rem),
  xl:   clamp(1.069rem, 0.941rem + 0.769vw, 1.282rem),
  "2xl": clamp(1.282rem, 1.069rem + 1.026vw, 1.604rem),
  "3xl": clamp(1.604rem, 1.282rem + 1.539vw, 1.923rem),
  "4xl": clamp(2rem, 1.923rem + 2.137vw, 2.565rem)
);


// -------------------------------
// Helpers SCSS
// -------------------------------
@function space($key) {
  @return map.get($space-scale, $key);
}

@function fs($key) {
  @return map.get($font-scale, $key);
}

@mixin focus-ring($color: hsl($brand-h 90% 50% / .45)) {
  outline: $outline-w solid transparent;
  box-shadow:
    0 0 0 $focus-ring-spread rgba(0,0,0,0),
    0 0 0 calc(#{$focus-ring-spread} + #{$outline-w}) #{$color};
}

@mixin clearfix {
  &::after { content: ""; display: table; clear: both; }
}

// -------------------------------
// Design Tokens (CSS Custom Props)
// -------------------------------
:root {
  color-scheme: light dark;
  --brand-h: #{$brand-h};

  /* Outros */
  --radius: #{$radius};
  --radius-table: 22px;
  --radiusxl: #{$radiusxl};
  --border-w: #{$border-w};

  /* Tipografia */
  --font-sans: #{$font-family-sans};
  --font-mono: #{$font-family-mono};
  --fs-4xs: #{fs("4xs")};
  --fs-3xs: #{fs("3xs")};
  --fs-2xs: #{fs("2xs")};
  --fs-xs: #{fs(xs)};
  --fs-sm: #{fs(sm)};
  --fs-base: #{fs(base)};
  --fs-lg: #{fs(lg)};
  --fs-xl: #{fs(xl)};
  --fs-2xl: #{fs("2xl")};
  --fs-3xl: #{fs("3xl")};
  --fs-4xl: #{fs("4xl")};

  /* Espaçamento */
  @for $i from 0 through 10 {
    --space-#{$i}: #{space($i)};
  }

  /* Seleção e caret */
  --selection-bg: hsl(var(--brand-h) 95% 85%);
  --selection-text: currentColor;
  --caret: hsl(var(--brand-h) 90% 45%);

  /* Sombra sutil */
  --shadow-1: 0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.03);

  
  --color-bg: hsl(40, 10%, 94%);
  --color-bg-elev: hsl(0 0% 100%);
  --color-bg-demote: hsl(168, 20%, 95%);
  --color-text: hsl(0, 0%, 13%);
  --color-muted: hsl(40, 10%, 94%);
  --color-border: hsl(0, 0%, 86%);
  --color-focus: hsl(var(--brand-h) 80% 58% / .6);
  --color-primary: hsl(var(--brand-h) 70% 49%);
  --color-primary-contrast: hsl(0 0% 100%);
  --color-link: hsl(var(--brand-h) 82% 42%);
  --color-link-visited: hsl(199, 70%, 49%);
}

[data-theme="dark"] {
  --color-bg: hsl(220, 18%, 10%);
  --color-bg-elev: hsl(220, 18%, 10%);
  --color-bg-demote: hsl(180, 2%, 12%);
  --color-text: hsl(220 14% 96%);
  --color-muted: hsl(220 10% 70%);
  --color-border: hsl(180, 1%, 28%);
  --color-focus: hsl(var(--brand-h) 90% 69% / .6);
  --color-primary: hsl(var(--brand-h) 80% 59%);
  --color-primary-contrast: hsl(220 18% 10%);
  --color-link: hsl(var(--brand-h) 85% 70%);
  --color-link-visited: hsl(272 70% 70%);
  --selection-bg: hsl(var(--brand-h) 50% 30%);
  --caret: hsl(var(--brand-h) 95% 70%);
}

// -------------------------------
// Base / Reset
// -------------------------------
*,
*::before,
*::after { box-sizing: border-box; }

html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  hanging-punctuation: first last;
  tab-size: 4;
  @if $enable-smooth-scroll { scroll-behavior: smooth; }
}

body {
  margin: 0;
  min-height: 100dvh;
  font-family: var(--font-sans);
  font-size: var(--fs-base);
  line-height: 115%;
  letter-spacing: 0;
  background: var(--color-bg);
  color: var(--color-text);
  accent-color: var(--color-primary);
  caret-color: var(--caret);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

:where(h1, h2) { text-wrap: balance; }
:where(p, li) { text-wrap: pretty; }

:where(h1, h2, h3, h4, h5, h6) {
  margin: 0 0 var(--space-5);
  font-weight: 700;
  line-height: 1.2;
}

h1 { font-size: var(--fs-4xl); }
h2 { font-size: var(--fs-3xl); }
h3 { font-size: var(--fs-2xl); }
h4 { font-size: var(--fs-xl); }
h5 { font-size: var(--fs-lg); }
h6 { font-size: var(--fs-base); }

p { margin: 0 0 var(--space-5); }

small { font-size: var(--fs-sm); }
strong { font-weight: 700; }
em { font-style: italic; }
abbr[title] { text-decoration: underline dotted; }

:where(ul, ol) {
  margin: 0 0 var(--space-5);
  padding-inline-start: 1.25rem;
}
:where(dl){ margin: 0 0 var(--space-5); }
:where(dt){ font-weight: 600; }
:where(dd){ margin-inline-start: var(--space-5); }

:where(blockquote) {
  margin: 0 0 var(--space-6);
  padding: var(--space-5) var(--space-6);
  border-inline-start: .25rem solid var(--color-border);
  color: var(--color-muted);
  background: color-mix(in oklab, var(--color-bg) 92%, var(--color-text) 8%);
}

hr {
  height: 0;
  border: 0;
  border-top: var(--border-w) solid var(--color-border);
  margin: var(--space-8) 0;
}

:where(a) {
  color: var(--color-link);
  text-decoration: underline;
  text-decoration-thickness: from-font;
  text-underline-offset: 0.15em;
  text-decoration-skip-ink: auto;
  outline: none;
}
a:hover { filter: brightness(0.95); }
a:visited { color: var(--color-link-visited); }
a:focus-visible { @include focus-ring(var(--color-focus)); }

::selection {
  background: var(--selection-bg);
  color: var(--selection-text);
}

img, svg, video, canvas, audio, iframe, embed, object {
  display: block;
  max-width: 100%;
}
img, video { height: auto; }
svg { fill: currentColor; }

:where(table) {
  width: 100%;
  border-collapse: collapse;
  border: var(--border-w) solid var(--color-border);
  background: transparent;
}
:where(th, td) {
  padding: var(--space-4) var(--space-5);
  border: var(--border-w) solid var(--color-border);
  text-align: start;
}
caption {
  caption-side: bottom;
  padding-top: var(--space-3);
  color: var(--color-muted);
  font-size: var(--fs-sm);
}

code, kbd, samp, pre {
  font-family: var(--font-mono);
  font-size: 0.95em;
}
pre {
  overflow: auto;
  padding: var(--space-5);
  margin: 0 0 var(--space-6);
  border-radius: var(--radius);
  background: color-mix(in oklab, var(--color-bg) 85%, var(--color-text) 15%);
  box-shadow: var(--shadow-1);
}

// -------------------------------
// Forms
// -------------------------------
:where(input, button, textarea, select) {
  font: inherit;
  color: inherit;
  letter-spacing: inherit;
}

:where(button, [type="button"], [type="submit"], [role="button"]) {
  -webkit-appearance: none;
  appearance: none;
  border: var(--border-w) solid var(--color-border);
  background: var(--color-bg-elev);
  color: inherit;
  padding: var(--space-4) var(--space-6);
  border-radius: var(--radius);
  box-shadow: var(--shadow-1);
  cursor: pointer;
  line-height: 1.2;
  transition: transform .06s ease, filter .12s ease, background-color .2s ease, border-color .2s ease;
}
button:hover { filter: brightness(0.98); }
button:active { transform: translateY(1px); }
button:disabled, [aria-disabled="true"] {
  opacity: .6;
  cursor: not-allowed;
  pointer-events: none;
}

:where(input, textarea, select) {
  width: 100%;
  background: var(--color-bg);
  border: var(--border-w) solid var(--color-border);
  border-radius: var(--radius);
  padding: var(--space-3) var(--space-4);
  outline: none;
  box-shadow: none;
}
:where(input, textarea, select):focus-visible {
  @include focus-ring(var(--color-focus));
}

textarea { min-height: 6rem; resize: vertical; }
select { background-image: none; }
label { display: inline-block; margin-bottom: var(--space-1); }
fieldset { border: var(--border-w) solid var(--color-border); border-radius: var(--radius); padding: var(--space-6); }
legend { padding: 0 var(--space-2); font-weight: 600; }

// Corrige tipos específicos
input[type="search"] { appearance: textfield; outline-offset: -2px; }
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
input[type="number"] { appearance: textfield; }
input[type="file"] { font: inherit; }
input::placeholder, textarea::placeholder {
  opacity: 1;
  color: color-mix(in oklab, var(--color-text) 30%, transparent);
}

// -------------------------------
// Acessibilidade e Interação
// -------------------------------
:focus { outline: none; }
:focus-visible { @include focus-ring(var(--color-focus)); }

[hidden] { display: none !important; }
[disabled] { cursor: not-allowed; }

.sr-only {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0, 0, 0, 0);
  white-space: nowrap; border: 0;
}

@media (prefers-reduced-motion: reduce) {
  * { animation-duration: .01ms !important; animation-iteration-count: 1 !important; transition-duration: .01ms !important; scroll-behavior: auto !important; }
}

@media (prefers-contrast: more) {
  :root { --color-border: color-mix(in oklab, var(--color-border), var(--color-text) 35%); }
}



// -------------------------------
// Layout Primitivos
// -------------------------------
.container {
  max-width: $container-max-width;
  margin-inline: auto;
  padding-inline: var(--space-6);
}

.stack > * + * { margin-block-start: var(--space-6); }
.cluster {
  display: flex; flex-wrap: wrap; gap: var(--space-5); align-items: center;
}

// -------------------------------
// Utilitários mínimos (opinionated)
// -------------------------------
.u-muted { color: var(--color-muted) !important; }
.u-clearfix { @include clearfix; }
.u-border { border: var(--border-w) solid var(--color-border) !important; border-radius: var(--radius); }
.u-elev { background: var(--color-bg-elev); box-shadow: var(--shadow-1); border-radius: var(--radius); }
.u-nowrap { white-space: nowrap !important; }
.u-break { overflow-wrap: break-word !important; word-break: break-word !important; }

// Espaçamento (margem/padding em eixos comuns)
@each $k, $val in $space-scale {
  .m-#{$k} { margin: #{$val} !important; }
  .p-#{$k} { padding: #{$val} !important; }
  .mt-#{$k} { margin-top: #{$val} !important; }
  .mb-#{$k} { margin-bottom: #{$val} !important; }
  .ms-#{$k} { margin-inline-start: #{$val} !important; }
  .me-#{$k} { margin-inline-end: #{$val} !important; }
  .pt-#{$k} { padding-top: #{$val} !important; }
  .pb-#{$k} { padding-bottom: #{$val} !important; }
  .ps-#{$k} { padding-inline-start: #{$val} !important; }
  .pe-#{$k} { padding-inline-end: #{$val} !important; }
}

// -------------------------------
// Scrollbars (suporte variável entre engines)
// -------------------------------
/* Firefox */
* { scrollbar-width: thin; scrollbar-color: color-mix(in oklab, var(--color-text) 25%, transparent) transparent; }
/* WebKit */
*::-webkit-scrollbar { width: .6rem; height: .6rem; }
*::-webkit-scrollbar-thumb {
  background-color: color-mix(in oklab, var(--color-text) 22%, transparent);
  border-radius: 999px;
}
*::-webkit-scrollbar-track { background: transparent; }

// -------------------------------
// Print
// -------------------------------
@if $enable-print-optimizations {
  @media print {
    * { background: transparent !important; box-shadow: none !important; }
    a, a:visited { text-decoration: underline; }
    abbr[title]::after { content: " (" attr(title) ")"; }
    pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
    tr, img { page-break-inside: avoid; }
    @page { margin: 1.5cm; }
  }
}
